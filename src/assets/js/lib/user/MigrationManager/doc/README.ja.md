# MigrationManager ライブラリ

**最終更新日:** 2025年12月3日

## 概要

`MigrationManager` は、古いバージョンのデータオブジェクト（設定など）を最新の形式に安全に変換（移行）するためのライブラリです。

アプリケーションのバージョンアップに伴うデータ構造の変更やプロパティ名の変更といった、後方互換性を損なう可能性のある更新を吸収し、アプリケーションの安定性と保守性を維持する役割を担います。

`MigrationManager` クラスを中核とし、「移行ルール」を外部から注入することで、任意のデータ構造を安全かつ堅牢に移行します。

## 主な機能

1. **クラスベース設計:**
	- `MigrationManager` が移行ロジックをカプセル化し、再利用可能な設計を提供します。
2. **依存性の注入 (DI):**
	- 移行ルールを外部から注入することで、コアロジックとルールを分離し、高い柔軟性を実現します。
3. **同期的・一括ルール読み込み:**
	- `import.meta.glob` と `loadRules` ユーティリティにより、複数のルールファイルを**同期的**に一括でインポート・管理できます。
	- > [!WARNING] Chrome 拡張機能の Service Worker 環境では、モジュールの動的インポートが動作しないため、同期読み込み (`{ eager: true }`) の指定が必須となります。
4. **汎用性と非同期対応:**
	- ジェネリクス `<T>` により、多様なデータ構造の移行に対応します。
	- ルール内の `condition` や `execute` 関数では `async/await` を使用できますが、**ルールモジュール自体の動的インポートは Service Worker 環境ではサポートされません。**
5. **安全性と一貫性:**
	- 移行処理はトランザクショナルに実行され、エラー発生時には変更がロールバックされます。処理全体が失敗した場合は、部分的に変更されたデータではなく、移行開始前の初期データを返却します。
6. **堅牢なエラーハンドリング:**
	- 個別のルールでエラーが発生してもプロセスは停止せず、詳細なエラーレポートを生成します。
7. **履歴追跡:**
	- 適用されたルールを記録し、デバッグと検証を容易にします。

## ドキュメント

より詳細な仕様や運用ポリシーについては、以下のドキュメントを参照してください。

- **動作仕様**
	- [MigrationManager.ja.md](./MigrationManager.ja.md): `MigrationManager` の設計思想、実行プロセス、基本的な使い方について。
	- [MigrationRule.ja.md](./MigrationRule.ja.md): 移行ルールの詳細な定義方法について。
	- [loadRules.ja.md](./loadRules.ja.md): ルールローダーユーティリティ `loadRules` の仕様と、**Service Worker 環境における重要な制約**について。
- **運用ポリシー**
	- [RuleManagementPolicy.ja.md](./RuleManagementPolicy.ja.md): 移行ルールのライフサイクル管理方針について。